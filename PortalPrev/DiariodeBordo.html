<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diário de Bordo</title>

<style>
    body {
        font-family: 'Verdana', sans-serif;
        margin: 20px;
        background: linear-gradient(135deg, #FF4500, #FF8C00, #FFA500);
        color: #333;
    }

/* TEXTO NOME DA FERRAMENTA */
.textotitulos {
    font-family: 'Raleway', sans-serif;
    font-size: 70px;
    font-weight: bold;
    text-align: center;
    color: #ffffff;
    text-shadow: 
        2px 2px 5px rgba(0, 0, 0, 0.5), 
        4px 4px 10px rgba(0, 0, 0, 0.4), 
        6px 6px 15px rgba(0, 0, 0, 0.3),
        8px 8px 20px rgba(0, 0, 0, 0.2);
        margin-top: 125px;

}
    h1, h2 {
        text-align: center;
        font-family: 'Arial', sans-serif;
    }
    .container {
        display: flex;
        justify-content: space-between;
        margin-bottom: 20px;
    }
    .left, .right {
        width: 45%;  /* Largura dos conteiners pequenos */
    }
    .bottom {
        width: 97%; /* Largura do conteiner inferior onde fica o resumo */
        margin-top: 20px;
    }
    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
    }
    th, td {
        border: 1px solid #ccc;
        padding: 10px;
        text-align: center;
    }

    form {
    display: flex;
    flex-direction: column;
    width: 400px; /* Ajuste a largura conforme necessário */
    margin-bottom: 10px; /* Espaço entre o rótulo e o campo */

    }
    
    label {
    font-weight: bold;
    margin-bottom: 5px;
    }

    button {
        background-color: #0070D2; /* Azul salesforce */
        color: white;
        border: 1px solid #0000CD; /* Azul escuro borda */
        padding: 2px 5px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 14px;
        box-shadow: 3px 3px 5px rgba(0, 0, 0, 0.4);
        transition: all 0.1s;
        height: auto;
        line-height: normal;

    }
    button:hover {
      background-color: #0000CD; /* Azul escuro para o efeito de destaque */
      box-shadow: 0 8px 20px rgba(52, 152, 219, 0.6); /* Sombra mais forte ao passar o mouse */
      transform: scale(1.05); /* Leve aumento de escala para destacar o botão */
    }

    .containerbotao {
    display: flex;
    justify-content: center; /* Centraliza horizontalmente */
    align-items: center; /* Centraliza verticalmente (se o contêiner tiver altura definida) */
    height: 10vh; /* Define a altura do contêiner para a altura total da tela */
    }

    .buttoninicial {
    background: #003366;
    color: white;
    border: none;
    padding: 10px 20px; /* Ajustado para um tamanho ideal */
    border-radius: 20px; /* Arredondamento mais sutil */
    cursor: pointer;
    font-size: 1em; /* Tamanho de fonte menor */
    box-shadow: 0 4px 12px rgba(0, 153, 255, 0.4); /* Efeito de sombra mais leve */
    transition: all 0.3s ease;
    text-decoration: none;
    display: inline-block;
    margin: 10px 5px; /* Ajustado para melhorar o espaçamento entre os botões */
    text-align: center; /* Alinha o texto no centro */
    width: 120px; /* Aumente a largura se necessário */
    margin: 0 auto; /* Centraliza horizontalmente */
    margin-bottom: 20px; /* Adiciona espaço abaixo do botão */
    margin-top: -30px; /* Reduz o espaço acima do botão */
    white-space: nowrap; /* Impede quebra de linha */

    }
    .buttoninicial:hover {
    background: #0000FF;
    transform: scale(1.1); /* Aumenta o tamanho do botão ao passar o mouse */
    box-shadow: 0 6px 18px rgba(0, 153, 255, 0.6); /* Aumenta o efeito de sombra ao passar o mouse */
    }
    .buttoninicial:active {
    box-shadow: 1px 1px 3px rgba(0, 0, 0, 0.4);
    transform: translate(2px, 2px);
    }

    .filter-container {
        margin-bottom: 20px;
        text-align: center;
    }

    .content-box, .bottom-box {
        background-color: #f9f9f9;
        padding: 20px;
        border: 1px solid #007bff;
        border-radius: 8px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    .summary-content {
        font-family: 'Courier New', monospace;
        white-space: pre-wrap;
        line-height: 1.5;
        text-align: left;
        margin-top: 20px;
    }
    .summary-result {
        background-color: #e9f5ff;
        padding: 15px;
        border: 1px solid #007bff;
        border-radius: 8px;
    }

    .imagemdiario img {
    width: 8%; /* Ajuste o tamanho da imagem */
    height: auto; /* Mantém a proporção da imagem */
    display: block;
    margin-left: 83%; /* Ajuste centralização da imagem */
    margin-top: 0%; /* Ajuste de altura da imagem */			
    margin-right: auto;
    margin-bottom: -30%; /* Ajuste de espaçamento embaixo */
    filter: brightness(50%); /* Escurece a imagem */		
    }

    .imagem-logowiz img {
    width: 30%; /* Ajuste o tamanho da imagem */
    height: auto; /* Mantém a proporção da imagem */
    display: block;
    margin-left: -2%; /* Ajuste centralização da imagem */
    margin-top: 15%; /* Ajuste de altura da imagem */			
    margin-right: auto;
    margin-bottom: -21%; /* Ajuste de espaçamento embaixo */
    filter: brightness(20%); /* Escurece a imagem */	
    }

</style>

</head>
<body>

          <div class="imagemdiario img">
          <div class="imagemdiario">
          <img src="https://makelo19.github.io/PortalPrev/Imagens/imagemdiario.png" alt="imagemdiario">
          </div>
          <div class="imagem-logowiz">
          <img src="https://makelo19.github.io/PortalPrev/Imagens/Wiz-Concept-Logo-Negativo-Fundo-Cinza.png" alt="Logo WizCo">
          </div>

  <h1 class="textotitulos";>Diário de Bordo</h1> 
  
  <div class="containerbotao">
  <a href="https://makelo19.github.io/PortalPrev/atalhos.html" class="buttoninicial">Página Inicial</a>
  </div>


    <div class="container">
    <!-- Diário de Bordo - Lado Esquerdo -->
    <div class="left content-box">
    <h1>Ocorências do Dia</h1>
    <form id="logForm">
    <label for="date">Data:</label><br>
    <input type="date" id="date" required><br>

    <label for="occurrences">Quantidade de Ocorrências:</label><br>
    <input type="number" id="occurrences" required><br>

    <label for="attendees">Quantidade de Pessoas em Atendimento:</label><br>
    <input type="number" id="attendees" required><br>

    <label for="impact">Impactos:</label><br>
    <select id="impact"> <!-- Removido o atributo multiple -->
        <option value="">Selecione um impacto...</option> <!-- Adicionada uma opção padrão -->
        <option value="Não houve impactos">Não houve impactos</option>
        <option value="Problema no Kiprev">Problema no Kiprev</option>
        <option value="Problema no Salesforce">Problema no Salesforce</option>
        <option value="Problema na VPN">Problema na VPN</option>
        <option value="Alto volume de solicitações">Alto volume de solicitações</option>
        <option value="Um usuário com problemas técnicos">Um usuário com problemas técnicos</option>
    </select><br>

    <label for="observations">Observações:</label><br>
    <textarea id="observations" rows="3"></textarea><br>

    <button type="submit">Salvar</button>
    </form>

    </div>

    <!-- Resumo do Filtro - Lado Direito -->
<div class="right content-box">
    <h1>Resumo</h1>
    <form id="logForm">
    <label for="startDate">Data Inicial:</label><br>
    <input type="date" id="startDate" onchange="updateSummary()"><br><br>
    
    <label for="endDate">Data Final:</label><br>
    <input type="date" id="endDate" onchange="updateSummary()"><br><br>

    <div id="summaryResults" class="summary-result"></div>
</div>
</div>

<!-- Resumo - Parte Inferior Centralizada -->
<div class="bottom bottom-box">
    <h1>Resumo Detalhado</h1>
    
    <div class="filter-container">
        <label for="filterDate">Filtrar por Data:</label>
        <input type="date" id="filterDate" onchange="filterByDate()">
        <button onclick="resetFilter()">Resetar Filtro</button>
    </div>

    <table>
        <thead>
            <tr>
                <th>Data</th>
                <th>Ocorrências</th>
                <th>Pessoas em Atendimento</th>
                <th>Impactos</th>
                <th>Observações</th>
                <th>Ações</th>
            </tr>
        </thead>
        <tbody id="logEntries"></tbody>
    </table>
</div>

<script>
    const logForm = document.getElementById('logForm');
    const logEntries = document.getElementById('logEntries');
    const summaryResults = document.getElementById('summaryResults');
    const dataStore = [];

    function loadEntries() {
        const entries = JSON.parse(localStorage.getItem('logEntries')) || [];
        logEntries.innerHTML = '';
        entries.forEach(entry => addEntryToTable(entry));
        dataStore.length = 0;
        dataStore.push(...entries);
        updateSummary();
    }

    function addEntryToTable(entry) {
        const row = document.createElement('tr');
        row.dataset.date = entry.date;
        row.innerHTML = `
            <td>${entry.date}</td>
            <td contenteditable="true" onblur="updateEntry(this, 'occurrences', '${entry.date}')" oninput="updateRealTime(this, 'occurrences', '${entry.date}')">${entry.occurrences}</td>
            <td contenteditable="true" onblur="updateEntry(this, 'attendees', '${entry.date}')" oninput="updateRealTime(this, 'attendees', '${entry.date}')">${entry.attendees}</td>
            <td>${entry.impacts.join(', ')}</td>
            <td contenteditable="true" onblur="updateEntry(this, 'observations', '${entry.date}')" oninput="updateRealTime(this, 'observations', '${entry.date}')">${entry.observations}</td>
            <td><button onclick="deleteEntry('${entry.date}')">Excluir</button></td>
        `;
        logEntries.appendChild(row);
    }

    logForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const date = document.getElementById('date').value;
        const occurrences = document.getElementById('occurrences').value;
        const attendees = document.getElementById('attendees').value;
        const impacts = Array.from(document.getElementById('impact').selectedOptions).map(option => option.value);
        const observations = document.getElementById('observations').value;

        const entry = { date, occurrences, attendees, impacts, observations };
        const entries = JSON.parse(localStorage.getItem('logEntries')) || [];
        entries.push(entry);
        localStorage.setItem('logEntries', JSON.stringify(entries));
        
        addEntryToTable(entry);
        dataStore.push(entry);
        updateSummary();
        logForm.reset();
    });

    function updateEntry(cell, field, date) {
        const entries = JSON.parse(localStorage.getItem('logEntries'));
        const entry = entries.find(e => e.date === date);
        if (entry) {
            entry[field] = cell.innerText;
            localStorage.setItem('logEntries', JSON.stringify(entries));
            updateSummary();
        }
    }

    function updateRealTime(cell, field, date) {
        const entries = JSON.parse(localStorage.getItem('logEntries'));
        const entry = entries.find(e => e.date === date);
        if (entry) {
            entry[field] = cell.innerText;
            localStorage.setItem('logEntries', JSON.stringify(entries));
        }
    }

    function deleteEntry(date) {
        const entries = JSON.parse(localStorage.getItem('logEntries'));
        const updatedEntries = entries.filter(e => e.date !== date);
        localStorage.setItem('logEntries', JSON.stringify(updatedEntries));
        loadEntries();
    }

    function filterByDate() {
        const filterDate = document.getElementById('filterDate').value;
        const rows = document.querySelectorAll('#logEntries tr');

        rows.forEach(row => {
            const rowDate = row.dataset.date;
            if (filterDate && rowDate !== filterDate) {
                row.style.display = 'none';
            } else {
                row.style.display = '';
            }
        });
    }

    function resetFilter() {
        document.getElementById('filterDate').value = '';
        filterByDate();
    }

function updateSummary() {
    const startDate = new Date(document.getElementById('startDate').value);
    const endDate = new Date(document.getElementById('endDate').value);
    const filteredData = filterData(startDate, endDate);

    let summaryContent = "Resumo do Filtro:\n";
    if (filteredData.length > 0) {
        const totalOccurrences = filteredData.reduce((sum, entry) => sum + parseInt(entry.occurrences, 10), 0);
        const totalAttendees = filteredData.reduce((sum, entry) => sum + parseInt(entry.attendees, 10), 0);
        const averageAttendees = filteredData.length > 0 ? (totalAttendees / filteredData.length).toFixed(2) : 0;
        const averageOccurrences = totalAttendees > 0 ? (totalOccurrences / totalAttendees).toFixed(2) : 0;

        const impactCounts = filteredData.reduce((counts, entry) => {
            entry.impacts.forEach(impact => counts[impact] = (counts[impact] || 0) + 1);
            return counts;
        }, {});

        summaryContent += `- Total de Ocorrências: ${totalOccurrences}\n`;
        summaryContent += `- Média de Pessoas em Atendimento: ${averageAttendees}\n`;
        summaryContent += `- Média de Ocorrências por Pessoa: ${averageOccurrences}\n\n`;
        summaryContent += `Impactos:\n`;
        for (const [impact, count] of Object.entries(impactCounts)) {
            summaryContent += `- ${impact}: ${count}\n`;
        }
    } else {
        summaryContent += "Nenhum dado encontrado para o período selecionado.";
    }

        summaryResults.innerHTML = summaryContent.replace(/\n/g, '<br>');
    }

    function filterData(startDate, endDate) {
        return dataStore.filter(entry => {
            const entryDate = new Date(entry.date);
            return (!isNaN(startDate) && entryDate >= startDate) && (!isNaN(endDate) && entryDate <= endDate);
        });
    }

    window.addEventListener('load', loadEntries);
</script>

</body>
</html>
